
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="FRAM demo documentation site">
      
      
        <meta name="author" content="NVE">
      
      
      
        <link rel="prev" href="../how_to_run_demo/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Code Reference - FRAM demo</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2a3383ac.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#code-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="FRAM demo" class="md-header__button md-logo" aria-label="FRAM demo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FRAM demo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Code Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/NVE/fram-demo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    NVE/fram-demo
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="FRAM demo" class="md-nav__button md-logo" aria-label="FRAM demo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    FRAM demo
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/NVE/fram-demo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    NVE/fram-demo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../how_to_run_demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to run the demo
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Code Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Code Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#framdemo" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;framdemo
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" framdemo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.EventHandler" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;EventHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EventHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.EventHandler.EventHandler" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;EventHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EventHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.EventHandler.EventHandler.handle_event" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;handle_event
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.dashboard_app" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;dashboard_app
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_1_download_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_1_download_dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_1_download_dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_1_download_dataset.demo_1_download_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_1_download_dataset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_2_populate_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_2_populate_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_2_populate_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_2_populate_model.demo_2_populate_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_2_populate_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_3_solve_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_3_solve_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_3_solve_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_3_solve_model.demo_3_solve_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_3_solve_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_4_modified_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_4_modified_solve
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_4_modified_solve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_4_modified_solve.demo_4_modified_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_4_modified_solve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_5_detailed_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_5_detailed_solve
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_5_detailed_solve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_5_detailed_solve.demo_5_detailed_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_5_detailed_solve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_6_nordic_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_6_nordic_solve
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_6_nordic_solve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_6_nordic_solve.demo_6_nordic_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_6_nordic_solve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_7_get_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_7_get_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_7_get_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_7_get_data.demo_7_get_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_7_get_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_8_run_dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_8_run_dashboard
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_8_run_dashboard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_8_run_dashboard.demo_8_run_dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_8_run_dashboard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_utils" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_utils.display" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;display
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_utils.load" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_utils.save" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;install_poetry
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" install_poetry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Cursor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Cursor
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Cursor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Cursor.clear_line" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Cursor.clear_line_after" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear_line_after
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Cursor.clear_output" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Cursor.clear_screen" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear_screen
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Installer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Installer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Installer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Installer.install" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;install
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#framdemo" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;framdemo
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" framdemo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.EventHandler" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;EventHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EventHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.EventHandler.EventHandler" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;EventHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" EventHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.EventHandler.EventHandler.handle_event" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;handle_event
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.dashboard_app" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;dashboard_app
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_1_download_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_1_download_dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_1_download_dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_1_download_dataset.demo_1_download_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_1_download_dataset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_2_populate_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_2_populate_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_2_populate_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_2_populate_model.demo_2_populate_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_2_populate_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_3_solve_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_3_solve_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_3_solve_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_3_solve_model.demo_3_solve_model" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_3_solve_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_4_modified_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_4_modified_solve
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_4_modified_solve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_4_modified_solve.demo_4_modified_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_4_modified_solve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_5_detailed_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_5_detailed_solve
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_5_detailed_solve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_5_detailed_solve.demo_5_detailed_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_5_detailed_solve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_6_nordic_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_6_nordic_solve
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_6_nordic_solve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_6_nordic_solve.demo_6_nordic_solve" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_6_nordic_solve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_7_get_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_7_get_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_7_get_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_7_get_data.demo_7_get_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_7_get_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_8_run_dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_8_run_dashboard
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_8_run_dashboard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_8_run_dashboard.demo_8_run_dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;demo_8_run_dashboard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_utils" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;demo_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" demo_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_utils.display" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;display
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_utils.load" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.demo_utils.save" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;install_poetry
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" install_poetry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Cursor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Cursor
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Cursor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Cursor.clear_line" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Cursor.clear_line_after" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear_line_after
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Cursor.clear_output" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Cursor.clear_screen" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;clear_screen
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Installer" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Installer
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Installer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#framdemo.install_poetry.Installer.install" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;install
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="code-reference">Code Reference</h1>


<div class="doc doc-object doc-module">



<h2 id="framdemo" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>framdemo</code>


</h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">











<div class="doc doc-object doc-module">



<h3 id="framdemo.EventHandler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>EventHandler</code>


</h3>

    <div class="doc doc-contents ">

        <p>Custom event handler to control display of demo output.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="framdemo.EventHandler.EventHandler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>EventHandler</code>


</h4>


    <div class="doc doc-contents ">


        <p>Handle events from framcore.events.send_event.</p>








              <details class="quote">
                <summary>Source code in <code>framdemo/EventHandler.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EventHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle events from framcore.events.send_event.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to handle event using rich.print. Use Python.print otherwise.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sender_name</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_event_using_rich</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_sender_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isbuiltin</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sender</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="n">is_func</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sender</span><span class="p">)))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>
            <span class="n">is_func</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">package</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">parents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;framcore&quot;</span><span class="p">,</span> <span class="s2">&quot;framdemo&quot;</span><span class="p">,</span> <span class="s2">&quot;framdata&quot;</span><span class="p">,</span> <span class="s2">&quot;framjules&quot;</span><span class="p">]:</span>
                <span class="n">package</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">name</span>
                <span class="k">break</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="n">is_func</span> <span class="k">else</span> <span class="nb">type</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_func</span><span class="p">:</span>
                <span class="n">caller_method_name</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">function</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">caller_method_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">package</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">package</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_event_using_rich</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sender_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">rich</span>  <span class="c1"># noqa: PLC0415</span>

        <span class="n">sender_color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
        <span class="n">sender_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">sender_color</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">sender_name</span><span class="si">}</span><span class="s2">: [/</span><span class="si">{</span><span class="n">sender_color</span><span class="si">}</span><span class="s2">]&quot;</span> <span class="k">if</span> <span class="n">sender_name</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">event_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">]:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
                <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
                <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;magenta&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
            <span class="p">}[</span><span class="n">event_type</span><span class="p">]</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>

            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">event_type</span><span class="si">}</span><span class="s2">: [/bold </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">sender_string</span><span class="si">}{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;display&quot;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;cyan&quot;</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">]</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">obj</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">digits_round</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;digits_round&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_prettify</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">digits_round</span><span class="p">)</span>
            <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">event_type</span><span class="si">}</span><span class="s2">: [/bold </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">sender_string</span><span class="si">}{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;cyan&quot;</span>
        <span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">event_type</span><span class="si">}</span><span class="s2">: [/bold </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">sender_string</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_try_prettify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">digits_round</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_len_1</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">copied_obj</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_convert_len_1_to_float</span><span class="p">(</span><span class="n">copied_obj</span><span class="p">,</span> <span class="n">digits_round</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">copied_obj</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_has_len_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">some_value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_len_1</span><span class="p">(</span><span class="n">some_value</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_len_1</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_len_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_len_1_to_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">digits_round</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_len_1_to_float</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">digits_round</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">digits_round</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="framdemo.EventHandler.EventHandler.handle_event" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">handle_event</span><span class="p">(</span><span class="n">sender</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Try to handle event using rich.print. Use Python.print otherwise.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/EventHandler.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">handle_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Try to handle event using rich.print. Use Python.print otherwise.&quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sender_name</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_event_using_rich</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.dashboard_app" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>dashboard_app</code>


</h3>

    <div class="doc doc-contents ">

        <p>Simple demo dashboard app.</p>










  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.demo_1_download_dataset" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>demo_1_download_dataset</code>


</h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_1_download_dataset.demo_1_download_dataset" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">demo_1_download_dataset</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Download the FRAM demo dataset from zenodo to the demo folder and unzip zip files.</p>
<ol>
<li>Dataset zip file is downloaded from https://zenodo.org/records/17294467 using REST api.</li>
<li>File is unzipped in the dataset folder. The file is unzipped in such a way that it skips the first directory level, so all the db_xx directories should
   be placed in the same folder as the zip file was downloaded to.</li>
<li>Zip file is deleted.</li>
</ol>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_1_download_dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demo_1_download_dataset</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download the FRAM demo dataset from zenodo to the demo folder and unzip zip files.</span>

<span class="sd">    1. Dataset zip file is downloaded from https://zenodo.org/records/17294467 using REST api.</span>
<span class="sd">    2. File is unzipped in the dataset folder. The file is unzipped in such a way that it skips the first directory level, so all the db_xx directories should</span>
<span class="sd">       be placed in the same folder as the zip file was downloaded to.</span>
<span class="sd">    3. Zip file is deleted.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">du</span><span class="o">.</span><span class="n">DATASET_SOURCE</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DATASET_SOURCE</span><span class="p">,</span> <span class="n">Path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">du</span><span class="o">.</span><span class="n">DATASET_SOURCE</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">time</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">send_info_event</span><span class="p">(</span><span class="n">demo_1_download_dataset</span><span class="p">,</span> <span class="s2">&quot;downloading dataset&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DATASET_SOURCE</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">DATASET_SOURCE</span> <span class="o">/</span> <span class="n">name</span>
            <span class="n">send_info_event</span><span class="p">(</span><span class="n">demo_1_download_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;database&quot;</span> <span class="o">/</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;database&quot;</span> <span class="o">/</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">send_info_event</span><span class="p">(</span><span class="n">demo_1_download_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;time download dataset </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
        <span class="k">return</span> 

    <span class="n">local_dataset_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;database&quot;</span>

    <span class="k">if</span> <span class="n">local_dataset_folder</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="n">local_dataset_folder</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()):</span>
        <span class="n">send_warning_event</span><span class="p">(</span><span class="n">demo_1_download_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Skipping download because there is already data in </span><span class="si">{</span><span class="n">local_dataset_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">zenodo_url</span> <span class="o">=</span> <span class="s2">&quot;https://zenodo.org/&quot;</span>
    <span class="n">dataset_id</span> <span class="o">=</span> <span class="s2">&quot;17294467&quot;</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="n">zenodo_url</span> <span class="o">+</span> <span class="s2">&quot;api/records/&quot;</span> <span class="o">+</span> <span class="n">dataset_id</span> <span class="o">+</span> <span class="s2">&quot;/files&quot;</span>  <span class="c1"># Insert ID of dataset</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">zenodo_url</span> <span class="o">+</span> <span class="s2">&quot;records/&quot;</span> <span class="o">+</span> <span class="n">dataset_id</span>

    <span class="n">local_dataset_folder</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">send_info_event</span><span class="p">(</span><span class="n">demo_1_download_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Downloading dataset from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> (this might take a few minutes)&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">)</span>
        <span class="n">files_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">file_info</span> <span class="ow">in</span> <span class="n">files_data</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">]:</span>
            <span class="n">file_url</span> <span class="o">=</span> <span class="n">file_info</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">][</span><span class="s2">&quot;self&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">file_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">file_url</span> <span class="o">=</span> <span class="n">zenodo_url</span> <span class="o">+</span> <span class="n">file_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">zenodo_url</span> <span class="o">+</span> <span class="s2">&quot;api/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">local_dataset_folder</span> <span class="o">/</span> <span class="n">file_info</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">is_zipfile</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)):</span>  <span class="c1"># for if the file already exists as a valid zip file.</span>
                <span class="n">send_info_event</span><span class="p">(</span><span class="n">demo_1_download_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Existing file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> exists and is a valid zipfile. Skipping download.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Download the file</span>
            <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file_url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
                <span class="k">with</span> <span class="n">file_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;An exception occured during download of dataset from Zenodo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">send_error_event</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="n">demo_1_download_dataset</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">exception_type_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">traceback</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span>
    <span class="n">send_info_event</span><span class="p">(</span><span class="n">demo_1_download_dataset</span><span class="p">,</span> <span class="s2">&quot;Dataset download finished.&quot;</span><span class="p">)</span>

    <span class="n">_unzip_files_in_folder</span><span class="p">(</span><span class="n">local_dataset_folder</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.demo_2_populate_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>demo_2_populate_model</code>


</h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_2_populate_model.demo_2_populate_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">demo_2_populate_model</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Populate model.</p>
<ol>
<li>Create model.</li>
<li>Use populator to fill model with data</li>
<li>Save model to disk for use in upcoming demos.</li>
<li>Display model content before and after population.</li>
</ol>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_2_populate_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demo_2_populate_model</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Populate model.</span>

<span class="sd">    1. Create model.</span>
<span class="sd">    2. Use populator to fill model with data</span>
<span class="sd">    3. Save model to disk for use in upcoming demos.</span>
<span class="sd">    4. Display model content before and after population.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framdata</span><span class="w"> </span><span class="kn">import</span> <span class="n">NVEEnergyModelPopulator</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">framdemo.demo_utils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">du</span>

    <span class="c1"># create empty model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>

    <span class="c1"># register model content before populate (for display below)</span>
    <span class="n">before</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_content_counts</span><span class="p">()</span>

    <span class="c1"># create populator connected to data source and</span>
    <span class="c1"># use it to populate the model with data objects</span>
    <span class="n">populator</span> <span class="o">=</span> <span class="n">NVEEnergyModelPopulator</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;database&quot;</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">populator</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="c1"># register model content after populate (for display below)</span>
    <span class="n">after</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_content_counts</span><span class="p">()</span>

    <span class="c1"># save populated model to disk so we can use it later</span>
    <span class="n">du</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;populated_model.pickle&quot;</span><span class="p">)</span>

    <span class="c1"># display how model was changed</span>
    <span class="n">du</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="s2">&quot;Model content before populate:&quot;</span><span class="p">,</span> <span class="n">before</span><span class="p">)</span>
    <span class="n">du</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="s2">&quot;Model content after populate:&quot;</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.demo_3_solve_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>demo_3_solve_model</code>


</h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_3_solve_model.demo_3_solve_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">demo_3_solve_model</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Solve model.</p>
<ol>
<li>Read populated model from populate model demo from disk.</li>
<li>Aggregate power nodes in model to elspot areas.</li>
<li>Create a JulES solver object.</li>
<li>Configure JulES.</li>
<li>Solve the model with JulES.</li>
</ol>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_3_solve_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demo_3_solve_model</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve model.</span>

<span class="sd">    1. Read populated model from populate model demo from disk.</span>
<span class="sd">    2. Aggregate power nodes in model to elspot areas.</span>
<span class="sd">    3. Create a JulES solver object.</span>
<span class="sd">    4. Configure JulES.</span>
<span class="sd">    5. Solve the model with JulES.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.aggregators</span><span class="w"> </span><span class="kn">import</span> <span class="n">HydroAggregator</span><span class="p">,</span> <span class="n">NodeAggregator</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.timeindexes</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelYear</span><span class="p">,</span> <span class="n">OneYearProfileTimeIndex</span><span class="p">,</span> <span class="n">WeeklyIndex</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.timevectors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListTimeVector</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">framjules</span><span class="w"> </span><span class="kn">import</span> <span class="n">JulES</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">framdemo.demo_utils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">du</span>

    <span class="n">model_year</span> <span class="o">=</span> <span class="n">ModelYear</span><span class="p">(</span><span class="mi">2025</span><span class="p">)</span>
    <span class="n">first_weather_year</span> <span class="o">=</span> <span class="mi">1995</span>
    <span class="n">num_weather_years</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">weekly_index</span> <span class="o">=</span> <span class="n">WeeklyIndex</span><span class="p">(</span><span class="n">first_weather_year</span><span class="p">,</span> <span class="n">num_weather_years</span><span class="p">)</span>

    <span class="c1"># Read populated model from populate model demo from disk.</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;populated_model.pickle&quot;</span><span class="p">)</span>

    <span class="c1"># Aggregate power nodes in model to elspot areas.</span>
    <span class="n">node_aggregator</span> <span class="o">=</span> <span class="n">NodeAggregator</span><span class="p">(</span><span class="s2">&quot;Power&quot;</span><span class="p">,</span> <span class="s2">&quot;elspot&quot;</span><span class="p">,</span> <span class="n">model_year</span><span class="p">,</span> <span class="n">weekly_index</span><span class="p">)</span>
    <span class="n">node_aggregator</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="c1"># Make a release_capacity_profile to further restrict the release capacity of the aggregated hydropower plants.</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.93</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">])</span>
    <span class="n">timeindex</span> <span class="o">=</span> <span class="n">OneYearProfileTimeIndex</span><span class="p">(</span><span class="n">period_duration</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span> <span class="n">is_52_week_years</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">release_capacity_profile</span> <span class="o">=</span> <span class="n">ListTimeVector</span><span class="p">(</span><span class="n">timeindex</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_max_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_zero_one_profile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Aggregate hydro power plants in model to elspot areas.</span>
    <span class="c1">#   HydroAggregator will create one run-of-river hydropower module and one reservoir hydropower module per elspot area.</span>
    <span class="c1">#   We use different aggregations for Norway and for Sweden and Finland.</span>
    <span class="c1">#   We use a ror_threshold of 0.6 for Norway and 0.38 for Sweden and Finland, which indicates what regulation factor</span>
    <span class="c1">#       a hydropower plant must have to be grouped as a reservoir hydropower plant.</span>
    <span class="n">hydro_aggregator_norway</span> <span class="o">=</span> <span class="n">HydroAggregator</span><span class="p">(</span>
        <span class="s2">&quot;EnergyEqDownstream&quot;</span><span class="p">,</span>
        <span class="n">model_year</span><span class="p">,</span>
        <span class="n">weekly_index</span><span class="p">,</span>
        <span class="n">ror_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">metakey_power_node</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span>
        <span class="n">power_node_members</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Norway&quot;</span><span class="p">],</span>
        <span class="n">release_capacity_profile</span><span class="o">=</span><span class="n">release_capacity_profile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">hydro_aggregator_norway</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="n">hydro_aggregator_sweden_finland</span> <span class="o">=</span> <span class="n">HydroAggregator</span><span class="p">(</span>
        <span class="s2">&quot;EnergyEqDownstream&quot;</span><span class="p">,</span>
        <span class="n">model_year</span><span class="p">,</span>
        <span class="n">weekly_index</span><span class="p">,</span>
        <span class="n">ror_threshold</span><span class="o">=</span><span class="mf">0.38</span><span class="p">,</span>
        <span class="n">metakey_power_node</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span>
        <span class="n">power_node_members</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sweden&quot;</span><span class="p">,</span> <span class="s2">&quot;Finland&quot;</span><span class="p">],</span>
        <span class="n">release_capacity_profile</span><span class="o">=</span><span class="n">release_capacity_profile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">hydro_aggregator_sweden_finland</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="c1"># Save aggregated model to disk so we can use it later</span>
    <span class="n">du</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;aggregated_model.pickle&quot;</span><span class="p">)</span>

    <span class="c1"># Create a JulES solver object.</span>
    <span class="n">jules</span> <span class="o">=</span> <span class="n">JulES</span><span class="p">()</span>

    <span class="c1"># ----- Configure JulES ------</span>

    <span class="c1"># Get object to configure JulES</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">jules</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>

    <span class="c1"># Configure serial simulation of model_year over all weather years</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_simulation_mode_serial</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_weather_years</span><span class="p">(</span><span class="n">first_weather_year</span><span class="p">,</span> <span class="n">num_weather_years</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_data_period</span><span class="p">(</span><span class="n">model_year</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_simulation_years</span><span class="p">(</span><span class="n">first_weather_year</span><span class="p">,</span> <span class="n">num_weather_years</span><span class="p">)</span>

    <span class="c1"># JulES can use this many cpu cores</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_num_cpu_cores</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">)</span>

    <span class="c1"># JulES shall write files to this folder</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_solve_folder</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;base&quot;</span><span class="p">)</span>

    <span class="c1"># Get object to configure time resolution</span>
    <span class="n">time_resolution</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_time_resolution</span><span class="p">()</span>

    <span class="c1"># 2-day clearing problem with 3-hour market periods and 2-day storage periods</span>
    <span class="n">time_resolution</span><span class="o">.</span><span class="n">set_clearing_market_minutes</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">time_resolution</span><span class="o">.</span><span class="n">set_clearing_storage_minutes</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">time_resolution</span><span class="o">.</span><span class="n">set_clearing_days</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># 1-day short term prognosis problem with 6-hour market periods and 1-day storage periods</span>
    <span class="n">time_resolution</span><span class="o">.</span><span class="n">set_short_market_minutes</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">time_resolution</span><span class="o">.</span><span class="n">set_short_storage_minutes</span><span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">time_resolution</span><span class="o">.</span><span class="n">set_short_days</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Configure medium and long term prognosis problem</span>
    <span class="c1"># and long term storage end value problem</span>
    <span class="c1">#   Total lookahead horizon must be at least 4 years</span>
    <span class="c1">#   Long term storage periods should be around 6 weeks long</span>
    <span class="c1">#   Medium term horizon should be around 26 weeks long</span>
    <span class="c1">#   Long term horizon for end value problems should be around 3 years</span>
    <span class="n">time_resolution</span><span class="o">.</span><span class="n">set_target_lookahead_days</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">365</span><span class="p">)</span>
    <span class="n">time_resolution</span><span class="o">.</span><span class="n">set_target_long_storage_days</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">time_resolution</span><span class="o">.</span><span class="n">set_target_med_days</span><span class="p">(</span><span class="mi">26</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">time_resolution</span><span class="o">.</span><span class="n">set_target_ev_days</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">365</span><span class="p">)</span>

    <span class="c1"># JulES can wait this many days between calculation</span>
    <span class="c1"># of opportunity cost of long term storage</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_skipmax_days</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>

    <span class="c1"># JulES shall use aggregated hydro power in price prognosis problems used to</span>
    <span class="c1"># HydroAggregator will create one run-of-river hydro plant and one hydro plant</span>
    <span class="c1"># with reservoir for each power market zone</span>
    <span class="c1"># hydro_aggregator = HydroAggregator(&quot;EnergyEqDownstream&quot;, model_year, weekly_index)</span>
    <span class="c1"># config.set_short_term_aggregations([hydro_aggregator])</span>

    <span class="c1"># JulES shall use EUR as currency (e.g. for prices)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_currency</span><span class="p">(</span><span class="s2">&quot;EUR&quot;</span><span class="p">)</span>

    <span class="c1"># JulES shall convert to these units for input and output</span>
    <span class="c1">#   We set Power as default so all other energy commodities (35 more)</span>
    <span class="c1">#   can use the same units as Power.</span>
    <span class="c1">#</span>
    <span class="c1">#   We must set units for Hydro and CO2 since these commodities</span>
    <span class="c1">#   need different units than Power.</span>
    <span class="c1">#</span>
    <span class="c1">#   For CO2, we only need to set stock unit, because this commodity</span>
    <span class="c1">#   is only used for exogenous nodes.</span>
    <span class="c1">#</span>
    <span class="c1">#   For more information about stock and flow, see: https://en.wikipedia.org/wiki/Stock_and_flow</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_commodity_units</span><span class="p">(</span><span class="n">commodity</span><span class="o">=</span><span class="s2">&quot;Power&quot;</span><span class="p">,</span> <span class="n">stock_unit</span><span class="o">=</span><span class="s2">&quot;GWh&quot;</span><span class="p">,</span> <span class="n">flow_unit</span><span class="o">=</span><span class="s2">&quot;MW&quot;</span><span class="p">,</span> <span class="n">is_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_commodity_units</span><span class="p">(</span><span class="n">commodity</span><span class="o">=</span><span class="s2">&quot;Hydro&quot;</span><span class="p">,</span> <span class="n">stock_unit</span><span class="o">=</span><span class="s2">&quot;Mm3&quot;</span><span class="p">,</span> <span class="n">flow_unit</span><span class="o">=</span><span class="s2">&quot;m3/s&quot;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_commodity_units</span><span class="p">(</span><span class="n">commodity</span><span class="o">=</span><span class="s2">&quot;CO2&quot;</span><span class="p">,</span> <span class="n">stock_unit</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>

    <span class="c1"># Install the git branch &quot;redesign_mfw&quot; for both JulES and TuLiPa</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_jules_version</span><span class="p">(</span><span class="n">jules_branch</span><span class="o">=</span><span class="s2">&quot;master&quot;</span><span class="p">,</span> <span class="n">tulipa_branch</span><span class="o">=</span><span class="s2">&quot;redesign_mfw&quot;</span><span class="p">)</span>

    <span class="c1"># Tell JulES where to find Julia and where to install JulES</span>
    <span class="k">if</span> <span class="n">du</span><span class="o">.</span><span class="n">JULIA_PATH_EXE</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_julia_exe_path</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">JULIA_PATH_EXE</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_julia_env_path</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;julia_env&quot;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_julia_depot_path</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;julia_depot&quot;</span><span class="p">)</span>

    <span class="c1"># Solve the model with JulES</span>
    <span class="n">jules</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.demo_4_modified_solve" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>demo_4_modified_solve</code>


</h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_4_modified_solve.demo_4_modified_solve" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">demo_4_modified_solve</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Use same model as demo 3 except one change. Reuse solver settings.</p>
<ol>
<li>Read aggregated model from demo 3 from disk</li>
<li>Read configured JulES solver used in demo 3 from disk</li>
<li>Make a few configurations</li>
<li>Increase demand in Norway with 20 percent</li>
<li>Solve the modified model with JulES</li>
</ol>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_4_modified_solve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demo_4_modified_solve</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use same model as demo 3 except one change. Reuse solver settings.</span>

<span class="sd">    1. Read aggregated model from demo 3 from disk</span>
<span class="sd">    2. Read configured JulES solver used in demo 3 from disk</span>
<span class="sd">    3. Make a few configurations</span>
<span class="sd">    4. Increase demand in Norway with 20 percent</span>
<span class="sd">    5. Solve the modified model with JulES</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.components</span><span class="w"> </span><span class="kn">import</span> <span class="n">Demand</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framjules</span><span class="w"> </span><span class="kn">import</span> <span class="n">JulES</span>

    <span class="c1"># import code written only for this demo (common names and useful functions)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">framdemo.demo_utils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">du</span>

    <span class="c1"># read aggregated model from demo 3 from disk</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;aggregated_model.pickle&quot;</span><span class="p">)</span>

    <span class="c1"># read configured jules solver used in demo 3 from disk</span>
    <span class="n">jules</span><span class="p">:</span> <span class="n">JulES</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;base&quot;</span> <span class="o">/</span> <span class="s2">&quot;solver.pickle&quot;</span><span class="p">)</span>

    <span class="c1"># Make a few configurations (where to save files and to reuse installation)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">jules</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_solve_folder</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;modified&quot;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">activate_skip_install_dependencies</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_num_cpu_cores</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">)</span>

    <span class="c1"># Increase demand in norwegian price areas with 20 percent</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Demand</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;NO1&quot;</span><span class="p">,</span> <span class="s2">&quot;NO2&quot;</span><span class="p">,</span> <span class="s2">&quot;NO3&quot;</span><span class="p">,</span> <span class="s2">&quot;NO4&quot;</span><span class="p">,</span> <span class="s2">&quot;NO5&quot;</span><span class="p">]:</span>
            <span class="n">value</span><span class="o">.</span><span class="n">get_capacity</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">1.2</span><span class="p">)</span>

    <span class="c1"># Solve the model with JulES</span>
    <span class="n">jules</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.demo_5_detailed_solve" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>demo_5_detailed_solve</code>


</h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_5_detailed_solve.demo_5_detailed_solve" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">demo_5_detailed_solve</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Use same model as demo 3 except with detailed hydro power instead of aggregated hydropower.</p>
<p>Solve model.
1. Read populated model from populate model demo from disk.
2. Aggregate power nodes in model to elspot areas.
3. Read configured JulES solver from demo 3.
4. Make a few configurations (where to save files and to reuse installation)
5. Create hydro power aggregators and put them into JulES via config
6. Solve the model with JulES.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_5_detailed_solve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demo_5_detailed_solve</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use same model as demo 3 except with detailed hydro power instead of aggregated hydropower.</span>

<span class="sd">    Solve model.</span>
<span class="sd">    1. Read populated model from populate model demo from disk.</span>
<span class="sd">    2. Aggregate power nodes in model to elspot areas.</span>
<span class="sd">    3. Read configured JulES solver from demo 3.</span>
<span class="sd">    4. Make a few configurations (where to save files and to reuse installation)</span>
<span class="sd">    5. Create hydro power aggregators and put them into JulES via config</span>
<span class="sd">    6. Solve the model with JulES.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.aggregators</span><span class="w"> </span><span class="kn">import</span> <span class="n">HydroAggregator</span><span class="p">,</span> <span class="n">NodeAggregator</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.timeindexes</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelYear</span><span class="p">,</span> <span class="n">OneYearProfileTimeIndex</span><span class="p">,</span> <span class="n">WeeklyIndex</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.timevectors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListTimeVector</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framjules</span><span class="w"> </span><span class="kn">import</span> <span class="n">JulES</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">framdemo.demo_utils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">du</span>

    <span class="c1"># Read populated model from populate model demo from disk.</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;populated_model.pickle&quot;</span><span class="p">)</span>

    <span class="c1"># read configured jules solver used in demo 3 from disk</span>
    <span class="n">jules</span><span class="p">:</span> <span class="n">JulES</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;base&quot;</span> <span class="o">/</span> <span class="s2">&quot;solver.pickle&quot;</span><span class="p">)</span>

    <span class="c1"># Make a few configurations (where to save files and to reuse installation)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">jules</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_solve_folder</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;detailed&quot;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">activate_skip_install_dependencies</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_num_cpu_cores</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">)</span>

    <span class="c1"># get info from config needed for the next steps</span>
    <span class="n">model_year</span><span class="p">:</span> <span class="n">ModelYear</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_data_period</span><span class="p">()</span>
    <span class="n">first_weather_year</span><span class="p">,</span> <span class="n">num_weather_years</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_weather_years</span><span class="p">()</span>
    <span class="n">weekly_index</span> <span class="o">=</span> <span class="n">WeeklyIndex</span><span class="p">(</span><span class="n">first_weather_year</span><span class="p">,</span> <span class="n">num_weather_years</span><span class="p">)</span>

    <span class="c1"># Aggregate power nodes in model to elspot areas.</span>
    <span class="n">node_aggregator</span> <span class="o">=</span> <span class="n">NodeAggregator</span><span class="p">(</span><span class="s2">&quot;Power&quot;</span><span class="p">,</span> <span class="s2">&quot;elspot&quot;</span><span class="p">,</span> <span class="n">model_year</span><span class="p">,</span> <span class="n">weekly_index</span><span class="p">)</span>
    <span class="n">node_aggregator</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="c1"># The below is different from demo 3.</span>
    <span class="c1"># In demo 3, we aggregate the input model here.</span>
    <span class="c1"># Here, we give JulES the hydro aggregators. This way, JulES will use detailed hydropower</span>
    <span class="c1"># in the simulation, and only use aggregated hydropower when estimating future prices</span>
    <span class="c1"># (we need aggregated hydropower in this step of JulES. Whithout it, the simulation would take forever to finish.</span>
    <span class="c1"># You can see for yourself by uncommenting</span>
    <span class="c1"># config.set_short_term_aggregations([hydro_aggregator_norway, hydro_aggregator_sweden_finland])</span>
    <span class="c1"># below. This line, which will trigger detailed hydropower in all of JulES)</span>

    <span class="c1"># Make a release_capacity_profile to further restrict the release capacity of the aggregated hydropower plants.</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.93</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">])</span>
    <span class="n">timeindex</span> <span class="o">=</span> <span class="n">OneYearProfileTimeIndex</span><span class="p">(</span><span class="n">period_duration</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">13</span><span class="p">),</span> <span class="n">is_52_week_years</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">release_capacity_profile</span> <span class="o">=</span> <span class="n">ListTimeVector</span><span class="p">(</span><span class="n">timeindex</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_max_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_zero_one_profile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Aggregate hydro power plants in model to elspot areas.</span>
    <span class="c1">#   HydroAggregator will create one run-of-river hydropower module and one reservoir hydropower module per elspot area.</span>
    <span class="c1">#   We use different aggregations for Norway and for Sweden and Finland.</span>
    <span class="c1">#   We use a ror_threshold of 0.6 for Norway and 0.38 for Sweden and Finland, which indicates what regulation factor</span>
    <span class="c1">#       a hydropower plant must have to be grouped as a reservoir hydropower plant.</span>
    <span class="n">hydro_aggregator_norway</span> <span class="o">=</span> <span class="n">HydroAggregator</span><span class="p">(</span>
        <span class="s2">&quot;EnergyEqDownstream&quot;</span><span class="p">,</span>
        <span class="n">model_year</span><span class="p">,</span>
        <span class="n">weekly_index</span><span class="p">,</span>
        <span class="n">ror_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">metakey_power_node</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span>
        <span class="n">power_node_members</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Norway&quot;</span><span class="p">],</span>
        <span class="n">release_capacity_profile</span><span class="o">=</span><span class="n">release_capacity_profile</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">hydro_aggregator_sweden_finland</span> <span class="o">=</span> <span class="n">HydroAggregator</span><span class="p">(</span>
        <span class="s2">&quot;EnergyEqDownstream&quot;</span><span class="p">,</span>
        <span class="n">model_year</span><span class="p">,</span>
        <span class="n">weekly_index</span><span class="p">,</span>
        <span class="n">ror_threshold</span><span class="o">=</span><span class="mf">0.38</span><span class="p">,</span>
        <span class="n">metakey_power_node</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span>
        <span class="n">power_node_members</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sweden&quot;</span><span class="p">,</span> <span class="s2">&quot;Finland&quot;</span><span class="p">],</span>
        <span class="n">release_capacity_profile</span><span class="o">=</span><span class="n">release_capacity_profile</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_short_term_aggregations</span><span class="p">([</span><span class="n">hydro_aggregator_norway</span><span class="p">,</span> <span class="n">hydro_aggregator_sweden_finland</span><span class="p">])</span>

    <span class="c1"># Solve the model with JulES</span>
    <span class="n">jules</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.demo_6_nordic_solve" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>demo_6_nordic_solve</code>


</h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_6_nordic_solve.demo_6_nordic_solve" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">demo_6_nordic_solve</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Use same as demo 4, but here we only simulate nordic zones, using prices from demo 3 as exogenous prices.</p>
<ol>
<li>Read aggregated model from demo 3 from disk</li>
<li>Filter dataset to only contain Nordic power market</li>
<li>Read configured JulES solver used in demo 3 from disk</li>
<li>Make a few configurations</li>
<li>Increase demand in Norway with 20 percent</li>
<li>Solve the modified model with JulES</li>
</ol>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_6_nordic_solve.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demo_6_nordic_solve</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use same as demo 4, but here we only simulate nordic zones, using prices from demo 3 as exogenous prices.</span>

<span class="sd">    1. Read aggregated model from demo 3 from disk</span>
<span class="sd">    2. Filter dataset to only contain Nordic power market</span>
<span class="sd">    3. Read configured JulES solver used in demo 3 from disk</span>
<span class="sd">    4. Make a few configurations</span>
<span class="sd">    5. Increase demand in Norway with 20 percent</span>
<span class="sd">    6. Solve the modified model with JulES</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.components</span><span class="w"> </span><span class="kn">import</span> <span class="n">Demand</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">isolate_subnodes</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framjules</span><span class="w"> </span><span class="kn">import</span> <span class="n">JulES</span>

    <span class="c1"># import code written only for this demo (common names and useful functions)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">framdemo.demo_utils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">du</span>

    <span class="c1"># read solved model from demo 3 from disk</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;base&quot;</span> <span class="o">/</span> <span class="s2">&quot;model.pickle&quot;</span><span class="p">)</span>

    <span class="c1"># Filter dataset to only contain Nordic power market</span>
    <span class="c1"># this will make price zones trading with the nordics</span>
    <span class="c1"># exogenous, and price results from demo 3 will be used</span>
    <span class="c1"># to represent the price in these zones</span>
    <span class="n">isolate_subnodes</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;Power&quot;</span><span class="p">,</span> <span class="s2">&quot;NordicRegion&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Inside&quot;</span><span class="p">])</span>

    <span class="c1"># read configured jules solver used in demo 3 from disk</span>
    <span class="n">jules</span><span class="p">:</span> <span class="n">JulES</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;base&quot;</span> <span class="o">/</span> <span class="s2">&quot;solver.pickle&quot;</span><span class="p">)</span>

    <span class="c1"># Make a few configurations (where to save files and to reuse installation)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">jules</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_solve_folder</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;nordic&quot;</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">activate_skip_install_dependencies</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">set_num_cpu_cores</span><span class="p">(</span><span class="n">num_cpu_cores</span><span class="p">)</span>

    <span class="c1"># Increase demand in norwegian price areas with 20 percent</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Demand</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">get_node</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;NO1&quot;</span><span class="p">,</span> <span class="s2">&quot;NO2&quot;</span><span class="p">,</span> <span class="s2">&quot;NO3&quot;</span><span class="p">,</span> <span class="s2">&quot;NO4&quot;</span><span class="p">,</span> <span class="s2">&quot;NO5&quot;</span><span class="p">]:</span>
            <span class="n">value</span><span class="o">.</span><span class="n">get_capacity</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">1.2</span><span class="p">)</span>

    <span class="c1"># Solve the model with JulES</span>
    <span class="n">jules</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.demo_7_get_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>demo_7_get_data</code>


</h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_7_get_data.demo_7_get_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">demo_7_get_data</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Writes results to h5 files that will be sent to dashboard.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_7_get_data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demo_7_get_data</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes results to h5 files that will be sent to dashboard.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.aggregators</span><span class="w"> </span><span class="kn">import</span> <span class="n">HydroAggregator</span><span class="p">,</span> <span class="n">NodeAggregator</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.components</span><span class="w"> </span><span class="kn">import</span> <span class="n">HydroModule</span><span class="p">,</span> <span class="n">Node</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.events</span><span class="w"> </span><span class="kn">import</span> <span class="n">send_info_event</span><span class="p">,</span> <span class="n">send_warning_event</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.expressions</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_level_value</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.querydbs</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheDB</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.timeindexes</span><span class="w"> </span><span class="kn">import</span> <span class="n">AverageYearRange</span><span class="p">,</span> <span class="n">DailyIndex</span><span class="p">,</span> <span class="n">ModelYear</span><span class="p">,</span> <span class="n">ProfileTimeIndex</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">framcore.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_regional_volumes</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">framjules</span><span class="w"> </span><span class="kn">import</span> <span class="n">JulES</span>

    <span class="c1"># import code written only for this demo (common names and useful functions)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">framdemo.demo_utils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">du</span>


    <span class="c1"># output file paths</span>
    <span class="n">h5_file_path_prices</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;dashboard_prices.h5&quot;</span>
    <span class="n">h5_file_path_volumes</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;dashboard_volumes.h5&quot;</span>
    <span class="n">h5_file_path_hydro</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;dashboard_hydro.h5&quot;</span>

    <span class="c1"># ==========================</span>
    <span class="c1"># Section: Price data</span>
    <span class="c1"># ==========================</span>

    <span class="c1"># get all power nodes</span>

    <span class="n">solve_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;modified&quot;</span><span class="p">,</span> <span class="s2">&quot;detailed&quot;</span><span class="p">,</span> <span class="s2">&quot;nordic&quot;</span><span class="p">]</span>

    <span class="c1"># read configured jules solver used in demo 3 from disk</span>
    <span class="n">jules</span><span class="p">:</span> <span class="n">JulES</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="n">solve_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;solver.pickle&quot;</span><span class="p">)</span>

    <span class="c1"># get info from config</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">jules</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="n">first_simulation_year</span><span class="p">,</span> <span class="n">num_simulation_years</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_simulation_years</span><span class="p">()</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_currency</span><span class="p">()</span>
    <span class="n">price_unit</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">currency</span><span class="si">}</span><span class="s2">/MWh&quot;</span>
    <span class="n">price_time_resolution</span> <span class="o">=</span> <span class="s2">&quot;Days&quot;</span>
    <span class="n">daily_index</span> <span class="o">=</span> <span class="n">DailyIndex</span><span class="p">(</span><span class="n">first_simulation_year</span><span class="p">,</span> <span class="n">num_simulation_years</span><span class="p">)</span>
    <span class="n">data_period</span><span class="p">:</span> <span class="n">ModelYear</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_data_period</span><span class="p">()</span>
    <span class="n">model_year</span> <span class="o">=</span> <span class="n">data_period</span><span class="o">.</span><span class="n">get_start_time</span><span class="p">()</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>

    <span class="n">common_metadata_is_not_written</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">h5_file_path_prices</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">solve_name</span> <span class="ow">in</span> <span class="n">solve_names</span><span class="p">:</span>
            <span class="n">send_info_event</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Getting prices for solve </span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">/model.pickle&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">send_warning_event</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Found no model for </span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">db</span> <span class="o">=</span> <span class="n">CacheDB</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Node</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">get_commodity</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Power&quot;</span><span class="p">:</span>
                    <span class="n">sanitized_zone</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                    <span class="n">store_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sanitized_zone</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">vector</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_price</span><span class="p">()</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">daily_index</span><span class="p">,</span> <span class="n">data_period</span><span class="p">,</span> <span class="n">price_unit</span><span class="p">)</span>
                    <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">store_key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">vector</span><span class="p">}))</span>

            <span class="k">if</span> <span class="n">common_metadata_is_not_written</span><span class="p">:</span>
                <span class="n">store</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">global_metadata</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;model_year&quot;</span><span class="p">:</span> <span class="n">model_year</span><span class="p">,</span>
                    <span class="s2">&quot;weather_years&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">range</span><span class="p">(</span><span class="n">first_simulation_year</span><span class="p">,</span> <span class="n">first_simulation_year</span> <span class="o">+</span> <span class="n">num_simulation_years</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="n">price_unit</span><span class="p">,</span>
                    <span class="s2">&quot;time_resolution&quot;</span><span class="p">:</span> <span class="n">price_time_resolution</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">common_metadata_is_not_written</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">send_info_event</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Saved price data to </span><span class="si">{</span><span class="n">h5_file_path_prices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ==========================</span>
    <span class="c1"># Section: Regional volumes</span>
    <span class="c1"># ==========================</span>
    <span class="n">category_total</span> <span class="o">=</span> <span class="s2">&quot;Total&quot;</span>
    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">h5_file_path_volumes</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">solve_name</span> <span class="ow">in</span> <span class="n">solve_names</span><span class="p">:</span>
            <span class="n">send_info_event</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Getting regional volumes for solve </span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">/model.pickle&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">db</span> <span class="o">=</span> <span class="n">CacheDB</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

            <span class="n">regional_volumes</span> <span class="o">=</span> <span class="n">get_regional_volumes</span><span class="p">(</span>
                <span class="n">db</span><span class="p">,</span>
                <span class="n">commodity</span><span class="o">=</span><span class="s2">&quot;Power&quot;</span><span class="p">,</span>
                <span class="n">node_category</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span>
                <span class="n">production_category</span><span class="o">=</span><span class="s2">&quot;HighLevelSource&quot;</span><span class="p">,</span>
                <span class="n">consumption_category</span><span class="o">=</span><span class="s2">&quot;TotalConsumption&quot;</span><span class="p">,</span>
                <span class="n">data_period</span><span class="o">=</span><span class="n">data_period</span><span class="p">,</span>
                <span class="n">scenario_period</span><span class="o">=</span><span class="n">AverageYearRange</span><span class="p">(</span><span class="n">first_simulation_year</span><span class="p">,</span> <span class="n">num_simulation_years</span><span class="p">),</span>
                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;GWh/year&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">production</span> <span class="o">=</span> <span class="n">regional_volumes</span><span class="o">.</span><span class="n">get_production</span><span class="p">()</span>
            <span class="n">consumption</span> <span class="o">=</span> <span class="n">regional_volumes</span><span class="o">.</span><span class="n">get_consumption</span><span class="p">()</span>
            <span class="n">_import</span> <span class="o">=</span> <span class="n">regional_volumes</span><span class="o">.</span><span class="n">get_import</span><span class="p">()</span>
            <span class="n">export</span> <span class="o">=</span> <span class="n">regional_volumes</span><span class="o">.</span><span class="n">get_export</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Production&quot;</span><span class="p">,</span> <span class="n">production</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Consumption&quot;</span><span class="p">,</span> <span class="n">consumption</span><span class="p">)]:</span>
                <span class="k">for</span> <span class="n">country</span><span class="p">,</span> <span class="n">category_data</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">sanitized_country</span> <span class="o">=</span> <span class="n">country</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                    <span class="n">total</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">category_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">sanitized_category</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span> <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">category</span>
                        <span class="k">assert</span> <span class="n">sanitized_category</span> <span class="o">!=</span> <span class="n">category_total</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sanitized_country</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sanitized_category</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">volume</span><span class="p">}))</span>
                        <span class="k">if</span> <span class="n">total</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">total</span> <span class="o">=</span> <span class="n">volume</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">total</span><span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sanitized_country</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">category_total</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">total</span><span class="p">}))</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;Import&quot;</span><span class="p">,</span> <span class="n">_import</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Export&quot;</span><span class="p">,</span> <span class="n">export</span><span class="p">)]:</span>
                <span class="k">for</span> <span class="n">country</span><span class="p">,</span> <span class="n">category_data</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">sanitized_country</span> <span class="o">=</span> <span class="n">country</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                    <span class="n">total</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">trading_partner</span><span class="p">,</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">category_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">sanitized_trading_partner</span> <span class="o">=</span> <span class="n">trading_partner</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sanitized_country</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sanitized_trading_partner</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">volume</span><span class="p">}))</span>
                        <span class="k">if</span> <span class="n">total</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">total</span> <span class="o">=</span> <span class="n">volume</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">total</span><span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sanitized_country</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">category_total</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="n">total</span><span class="p">}))</span>

    <span class="n">send_info_event</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Saved regional volume data to </span><span class="si">{</span><span class="n">h5_file_path_volumes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ==========================</span>
    <span class="c1"># Section: Hydro data</span>
    <span class="c1"># ==========================</span>

    <span class="n">countries</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Norway&quot;</span><span class="p">,</span> <span class="s2">&quot;Sweden&quot;</span><span class="p">,</span> <span class="s2">&quot;Finland&quot;</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">h5_file_path_hydro</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">solve_name</span> <span class="ow">in</span> <span class="n">solve_names</span><span class="p">:</span>
            <span class="n">send_info_event</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Getting hydro volumes for solve </span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">/model.pickle&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">solve_name</span> <span class="o">!=</span> <span class="s2">&quot;detailed&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">disaggregate</span><span class="p">()</span>

            <span class="n">node_aggregator</span> <span class="o">=</span> <span class="n">NodeAggregator</span><span class="p">(</span><span class="s2">&quot;Power&quot;</span><span class="p">,</span> <span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="n">data_period</span><span class="p">,</span> <span class="n">daily_index</span><span class="p">)</span>
            <span class="n">node_aggregator</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="n">hydro_aggregator</span> <span class="o">=</span> <span class="n">HydroAggregator</span><span class="p">(</span><span class="s2">&quot;EnergyEqDownstream&quot;</span><span class="p">,</span> <span class="n">data_period</span><span class="p">,</span> <span class="n">daily_index</span><span class="p">)</span>
            <span class="n">hydro_aggregator</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

            <span class="n">db</span> <span class="o">=</span> <span class="n">CacheDB</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">country</span> <span class="ow">in</span> <span class="n">countries</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">country</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;reservoir_volume&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir_capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;production&quot;</span><span class="p">,</span> <span class="s2">&quot;inflow&quot;</span><span class="p">]:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">country</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">daily_index</span><span class="o">.</span><span class="n">get_num_periods</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">HydroModule</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="c1"># works since hydro module is aggregated to country</span>
                <span class="n">country</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get_generator</span><span class="p">()</span><span class="o">.</span><span class="n">get_power_node</span><span class="p">()</span>

                <span class="n">reservoir</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get_reservoir</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">reservoir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">country</span><span class="p">][</span><span class="s2">&quot;reservoir_volume&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">get_volume</span><span class="p">()</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">daily_index</span><span class="p">,</span> <span class="n">data_period</span><span class="p">,</span> <span class="s2">&quot;Mm3&quot;</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">country</span><span class="p">][</span><span class="s2">&quot;reservoir_capacity&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">get_capacity</span><span class="p">()</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">daily_index</span><span class="p">,</span> <span class="n">data_period</span><span class="p">,</span> <span class="s2">&quot;Mm3&quot;</span><span class="p">)</span>

                <span class="n">production</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get_generator</span><span class="p">()</span><span class="o">.</span><span class="n">get_production</span><span class="p">()</span>
                <span class="n">data</span><span class="p">[</span><span class="n">country</span><span class="p">][</span><span class="s2">&quot;production&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">production</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">daily_index</span><span class="p">,</span> <span class="n">data_period</span><span class="p">,</span> <span class="s2">&quot;MW&quot;</span><span class="p">)</span>

                <span class="n">inflow</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get_inflow</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">inflow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">country</span><span class="p">][</span><span class="s2">&quot;inflow&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">inflow</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">daily_index</span><span class="p">,</span> <span class="n">data_period</span><span class="p">,</span> <span class="s2">&quot;m3/s&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">country</span><span class="p">,</span> <span class="n">area_data</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">area_data</span><span class="p">[</span><span class="s2">&quot;reservoir_capacity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">area_data</span><span class="p">[</span><span class="s2">&quot;reservoir_percentage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_data</span><span class="p">[</span><span class="s2">&quot;reservoir_capacity&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">area_data</span><span class="p">[</span><span class="s2">&quot;reservoir_percentage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_data</span><span class="p">[</span><span class="s2">&quot;reservoir_volume&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">area_data</span><span class="p">[</span><span class="s2">&quot;reservoir_capacity&quot;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">country</span><span class="p">,</span> <span class="n">area_data</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">area_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solve_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">country</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">vector</span><span class="p">}))</span>

    <span class="n">send_info_event</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Saved hydro data to </span><span class="si">{</span><span class="n">h5_file_path_hydro</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="c1"># detailed hydro data</span>

    <span class="c1"># input solve name and file paths</span>
    <span class="n">solve_name</span> <span class="o">=</span> <span class="s2">&quot;detailed&quot;</span>

    <span class="n">solve_dir</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="n">solve_name</span>
    <span class="n">solver_path</span> <span class="o">=</span> <span class="n">solve_dir</span> <span class="o">/</span> <span class="s2">&quot;solver.pickle&quot;</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">solve_dir</span> <span class="o">/</span> <span class="s2">&quot;model.pickle&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">solve_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">and</span> <span class="n">solver_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">model_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()):</span>
        <span class="k">return</span>

    <span class="c1"># output file paths</span>
    <span class="n">output_file_path</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="s2">&quot;dashboard_detailed_hydro.h5&quot;</span>

    <span class="c1"># get info from configured jules solver</span>
    <span class="n">jules</span><span class="p">:</span> <span class="n">JulES</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">solver_path</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">jules</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
    <span class="n">first_simulation_year</span><span class="p">,</span> <span class="n">num_simulation_years</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_simulation_years</span><span class="p">()</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_currency</span><span class="p">()</span>
    <span class="n">clearing_market_minutes</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_time_resolution</span><span class="p">()</span><span class="o">.</span><span class="n">get_clearing_market_minutes</span><span class="p">()</span>

    <span class="c1"># derive query inputs</span>
    <span class="n">data_period</span><span class="p">:</span> <span class="n">ModelYear</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_data_period</span><span class="p">()</span>
    <span class="n">model_year</span> <span class="o">=</span> <span class="n">data_period</span><span class="o">.</span><span class="n">get_start_time</span><span class="p">()</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
    <span class="n">data_dim</span> <span class="o">=</span> <span class="n">ModelYear</span><span class="p">(</span><span class="n">model_year</span><span class="p">)</span>
    <span class="n">scen_dim_yr</span> <span class="o">=</span> <span class="n">AverageYearRange</span><span class="p">(</span><span class="n">first_simulation_year</span><span class="p">,</span> <span class="n">num_simulation_years</span><span class="p">)</span>
    <span class="n">scen_dim_market</span> <span class="o">=</span> <span class="n">ProfileTimeIndex</span><span class="p">(</span><span class="n">first_simulation_year</span><span class="p">,</span> <span class="n">num_simulation_years</span><span class="p">,</span> <span class="n">period_duration</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">clearing_market_minutes</span><span class="p">),</span> <span class="n">is_52_week_years</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># get model</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">du</span><span class="o">.</span><span class="n">DEMO_FOLDER</span> <span class="o">/</span> <span class="n">solve_name</span> <span class="o">/</span> <span class="s2">&quot;model.pickle&quot;</span><span class="p">)</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">CacheDB</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

    <span class="c1"># create module_df</span>
    <span class="n">send_info_event</span><span class="p">(</span><span class="n">demo_7_get_data</span><span class="p">,</span> <span class="s2">&quot;creating module_df&quot;</span><span class="p">)</span>
    <span class="n">eneq_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">HydroModule</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">generator</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_generator</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">generator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">get_production</span><span class="p">()</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">scen_dim_yr</span><span class="p">,</span> <span class="n">data_dim</span><span class="p">,</span> <span class="s2">&quot;GWh/year&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;ProductionGWhPerYear&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">pump</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_pump</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pump</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pump</span><span class="o">.</span><span class="n">get_power_consumption</span><span class="p">()</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">scen_dim_yr</span><span class="p">,</span> <span class="n">data_dim</span><span class="p">,</span> <span class="s2">&quot;GWh/year&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;PumpConsumptionGWhPerYear&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">reservoir</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_reservoir</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">reservoir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">eneq</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get_meta</span><span class="p">(</span><span class="s2">&quot;EnergyEqDownstream&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eneq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">eneq_kwh_per_m3</span> <span class="o">=</span> <span class="n">get_level_value</span><span class="p">(</span><span class="n">eneq</span><span class="o">.</span><span class="n">get_value</span><span class="p">(),</span> <span class="n">db</span><span class="p">,</span> <span class="s2">&quot;kWh/m3&quot;</span><span class="p">,</span> <span class="n">data_dim</span><span class="p">,</span> <span class="n">scen_dim_yr</span><span class="p">,</span> <span class="n">is_max</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eneq_kwh_per_m3</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">eneq_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">eneq_kwh_per_m3</span>
        <span class="n">reservoir_cap_mm3</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">get_capacity</span><span class="p">()</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">scen_dim_yr</span><span class="p">,</span> <span class="n">data_dim</span><span class="p">,</span> <span class="s2">&quot;Mm3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">reservoir_cap_gwh</span> <span class="o">=</span> <span class="n">eneq_kwh_per_m3</span> <span class="o">*</span> <span class="n">reservoir_cap_mm3</span>
        <span class="k">if</span> <span class="n">reservoir_cap_mm3</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># TODO: replace dummy data with hydro_module.get_scenario_vector call</span>
        <span class="n">water_value</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="c1"># water_value = value.get_water_value().get_scenario_vector(db, scen_dim_yr, data_dim, f&quot;{currency}/m3&quot;)</span>
        <span class="n">water_value</span> <span class="o">=</span> <span class="n">water_value</span> <span class="o">/</span> <span class="n">eneq_kwh_per_m3</span> <span class="c1"># EUR/m3 to EUR/kWh</span>
        <span class="n">water_value</span> <span class="o">=</span> <span class="n">water_value</span> <span class="o">*</span> <span class="mf">1000.0</span>          <span class="c1"># EUR/kWh to EUR/MWh</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;ReservoirCapacityMm3&quot;</span><span class="p">,</span> <span class="n">reservoir_cap_mm3</span><span class="p">))</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;ReservoirCapacityGWh&quot;</span><span class="p">,</span> <span class="n">reservoir_cap_gwh</span><span class="p">))</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;EnergyEqDownstream&quot;</span><span class="p">,</span> <span class="n">eneq_kwh_per_m3</span><span class="p">))</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;WaterValueEURPerMWh&quot;</span><span class="p">,</span> <span class="n">water_value</span><span class="p">))</span>
    <span class="n">modules_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Module&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">])</span>

    <span class="c1"># find biggest reservoirs</span>
    <span class="n">send_info_event</span><span class="p">(</span><span class="n">demo_7_get_data</span><span class="p">,</span> <span class="s2">&quot;finding biggest reservoirs&quot;</span><span class="p">)</span>
    <span class="n">biggest</span> <span class="o">=</span> <span class="n">modules_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">biggest</span> <span class="o">=</span> <span class="n">biggest</span><span class="p">[</span><span class="n">biggest</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ReservoirCapacityGWh&quot;</span><span class="p">]</span>
    <span class="n">biggest</span> <span class="o">=</span> <span class="n">biggest</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">biggest</span> <span class="o">=</span> <span class="n">biggest</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">biggest</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">biggest</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">20</span><span class="p">][</span><span class="s2">&quot;Module&quot;</span><span class="p">])</span>

    <span class="c1"># find price area for each biggest reservoir</span>
    <span class="n">power_node_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">biggest</span><span class="p">:</span>
        <span class="n">next_key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="n">power_node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">power_node</span><span class="p">:</span>
            <span class="n">hydro_module</span><span class="p">:</span> <span class="n">HydroModule</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">next_key</span><span class="p">]</span>
            <span class="n">generator</span> <span class="o">=</span> <span class="n">hydro_module</span><span class="o">.</span><span class="n">get_generator</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">generator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">power_node</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">get_power_node</span><span class="p">()</span>
                <span class="k">break</span>
            <span class="n">pump</span> <span class="o">=</span> <span class="n">hydro_module</span><span class="o">.</span><span class="n">get_pump</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">pump</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">power_node</span> <span class="o">=</span> <span class="n">pump</span><span class="o">.</span><span class="n">get_power_node</span><span class="p">()</span>
                <span class="k">break</span>
            <span class="n">next_key</span> <span class="o">=</span> <span class="n">hydro_module</span><span class="o">.</span><span class="n">get_release_to</span><span class="p">()</span>
        <span class="n">power_node_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">power_node</span>

    <span class="c1"># get prices for each relevant power node</span>
    <span class="n">power_prices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">power_node_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_price</span><span class="p">()</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">scen_dim_market</span><span class="p">,</span> <span class="n">data_dim</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">currency</span><span class="si">}</span><span class="s2">/MWh&quot;</span><span class="p">)</span>
        <span class="n">power_prices</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span>

    <span class="c1"># create series_df for the biggest reservoirs</span>
    <span class="n">send_info_event</span><span class="p">(</span><span class="n">demo_7_get_data</span><span class="p">,</span> <span class="s2">&quot;creating series_df for biggest reservoirs&quot;</span><span class="p">)</span>
    <span class="n">series_df</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">biggest</span><span class="p">:</span>
        <span class="n">hydro_module</span><span class="p">:</span> <span class="n">HydroModule</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">reservoir</span> <span class="o">=</span> <span class="n">hydro_module</span><span class="o">.</span><span class="n">get_reservoir</span><span class="p">()</span>
        <span class="n">eneq_kwh_per_m3</span> <span class="o">=</span> <span class="n">eneq_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">reservoir_cap_mm3_series</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">get_capacity</span><span class="p">()</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">scen_dim_market</span><span class="p">,</span> <span class="n">data_dim</span><span class="p">,</span> <span class="s2">&quot;Mm3&quot;</span><span class="p">)</span>
        <span class="n">reservoir_vol_mm3_series</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">get_volume</span><span class="p">()</span><span class="o">.</span><span class="n">get_scenario_vector</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">scen_dim_market</span><span class="p">,</span> <span class="n">data_dim</span><span class="p">,</span> <span class="s2">&quot;Mm3&quot;</span><span class="p">)</span>
        <span class="n">reservoir_filling</span> <span class="o">=</span> <span class="n">reservoir_vol_mm3_series</span> <span class="o">/</span> <span class="n">reservoir_cap_mm3_series</span>
        <span class="c1"># TODO: replace dummy data with hydro_module.get_scenario_vector call</span>
        <span class="n">water_values</span> <span class="o">=</span> <span class="n">reservoir_filling</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">water_values</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mf">50.0</span><span class="p">)</span>
        <span class="c1"># water_values = hydro_module.get_water_value().get_scenario_vector(db, scen_dim_market, data_dim, f&quot;{currency}/m3&quot;)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">water_value</span><span class="p">,</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">eneq_kwh_per_m3</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">water_values</span><span class="p">)</span>
        <span class="n">series_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ReservoirFilling/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reservoir_filling</span>
        <span class="n">series_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;WaterValueEURPerMWh/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">water_values</span>
        <span class="n">series_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;PowerPriceEURPerMWh/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">power_prices</span><span class="p">[</span><span class="n">power_node_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>

    <span class="n">series_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">series_df</span><span class="p">)</span>

    <span class="c1"># write result file</span>
    <span class="n">send_info_event</span><span class="p">(</span><span class="n">demo_7_get_data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;writing result file: </span><span class="si">{</span><span class="n">output_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
        <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;modules_df&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">modules_df</span><span class="p">)</span>
        <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;series_df&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">series_df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.demo_8_run_dashboard" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>demo_8_run_dashboard</code>


</h3>

    <div class="doc doc-contents ">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_8_run_dashboard.demo_8_run_dashboard" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">demo_8_run_dashboard</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Runs dashboard with results in your browser.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_8_run_dashboard.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">demo_8_run_dashboard</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs dashboard with results in your browser.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">webbrowser</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_available_port</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find an available local port by binding to port 0.</span>

<span class="sd">        The operating system will assign a free port.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>

        <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Binds to an available port on all interfaces</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Returns the assigned port number</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_streamlit_cmd_path</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search sys.path and return first path to streamlit.cmd.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_get_streamlit_cmd_path</span><span class="p">(</span><span class="n">paths</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;streamlit.cmd&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">path</span>
                <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">_get_streamlit_cmd_path</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">result</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">_get_streamlit_cmd_path</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">Path</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_browser_exe_path</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find a browser supported by streamlit.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">browsers</span>

        <span class="c1"># safari is also supported by streamlit, but not findable with pybrowsers it seems</span>
        <span class="n">findable_and_supported_by_streamlit</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;chrome&quot;</span><span class="p">,</span> <span class="s2">&quot;msedge&quot;</span><span class="p">,</span> <span class="s2">&quot;firefox&quot;</span><span class="p">]</span>

        <span class="n">browser_dicts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">browsers</span><span class="o">.</span><span class="n">browsers</span><span class="p">())</span>

        <span class="n">browser_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">browser_dicts</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;browser_type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">findable_and_supported_by_streamlit</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">browser_dicts</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Was not able to automatically find a supported browser. Need chrome, msedge or firefox to run.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">browser_dicts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>

    <span class="n">current_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">app_path</span> <span class="o">=</span> <span class="n">current_folder</span> <span class="o">/</span> <span class="s2">&quot;dashboard_app.py&quot;</span>

    <span class="n">port</span> <span class="o">=</span> <span class="n">get_available_port</span><span class="p">()</span>

    <span class="c1"># Open the Streamlit app in browser</span>
    <span class="n">webbrowser</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;streamlit_browser&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">BackgroundBrowser</span><span class="p">(</span><span class="n">get_browser_exe_path</span><span class="p">()))</span>

    <span class="c1"># Run the Streamlit app</span>
    <span class="n">streamlit_cmd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_streamlit_cmd_path</span><span class="p">())</span> <span class="ow">or</span> <span class="s2">&quot;streamlit&quot;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">streamlit_cmd</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">app_path</span><span class="p">),</span> <span class="s2">&quot;--server.port&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">)],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.demo_utils" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>demo_utils</code>


</h3>

    <div class="doc doc-contents ">

        <p>Contains paths that may be set by users to override default behaviour.</p>
<p>Contains constants and small utility functions to make the demos more robust and easier to follow.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_utils.display" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">display</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">digits_round</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Send an object to EventHandler for display.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">digits_round</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send an object to EventHandler for display.&quot;&quot;&quot;</span>
    <span class="n">send_event</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;display&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="nb">object</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">digits_round</span><span class="o">=</span><span class="n">digits_round</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_utils.load" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Read object from pickle file.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read object from pickle file.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="framdemo.demo_utils.save" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Write object to pickle file at given path.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/demo_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write object to pickle file at given path.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">Path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="framdemo.install_poetry" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>install_poetry</code>


</h3>

    <div class="doc doc-contents ">

        <p>This script will install Poetry and its dependencies in an isolated fashion.</p>


<details class="it-will-perform-the-following-steps" open>
  <summary>It will perform the following steps</summary>
  <ul>
<li>Create a new virtual environment using the built-in venv module, or the virtualenv zipapp if venv is unavailable.
  This will be created at a platform-specific path (or <code>$POETRY_HOME</code> if <code>$POETRY_HOME</code> is set:<ul>
<li><code>~/Library/Application Support/pypoetry</code> on macOS</li>
<li><code>$XDG_DATA_HOME/pypoetry</code> on Linux/Unix (<code>$XDG_DATA_HOME</code> is <code>~/.local/share</code> if unset)</li>
<li><code>%APPDATA%\pypoetry</code> on Windows</li>
</ul>
</li>
<li>Update pip inside the virtual environment to avoid bugs in older versions.</li>
<li>Install the latest (or a given) version of Poetry inside this virtual environment using pip.</li>
<li>Install a <code>poetry</code> script into a platform-specific path (or <code>$POETRY_HOME/bin</code> if <code>$POETRY_HOME</code> is set):<ul>
<li><code>~/.local/bin</code> on Unix</li>
<li><code>%APPDATA%\Python\Scripts</code> on Windows</li>
</ul>
</li>
<li>Attempt to inform the user if they need to add this bin directory to their <code>$PATH</code>, as well as how to do so.</li>
<li>Upon failure, write an error log to `poetry-installer-error-<hash>.log and restore any previous environment.</li>
</ul>
</details>        <p>This script performs minimal magic, and should be relatively stable. However, it is optimized for interactive developer
use and trivial pipelines. If you are considering using this script in production, you should consider manually-managed
installs, or use of pipx as alternatives to executing arbitrary, unversioned code from the internet. If you prefer this
script to alternatives, consider maintaining a local copy as part of your infrastructure.</p>
<p>For full documentation, visit https://python-poetry.org/docs/#installation.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="framdemo.install_poetry.Cursor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>Cursor</code>


</h4>


    <div class="doc doc-contents ">









              <details class="quote">
                <summary>Source code in <code>framdemo/install_poetry.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Cursor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">lines</span><span class="si">}</span><span class="s2">A&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">lines</span><span class="si">}</span><span class="s2">B&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">C&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">D&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move_to_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">G&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[</span><span class="si">{</span><span class="n">row</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">H&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">7&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">restore_position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">8&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[?25l&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[?25h</span><span class="se">\x1b</span><span class="s2">[?0c&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_line</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears all the output from the current line.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[2K&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_line_after</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears all the output from the current line after the current position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[K&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears all the output from the cursors&#39; current position</span>
<span class="sd">        to the end of the screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0J&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the entire screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[2J&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="framdemo.install_poetry.Cursor.clear_line" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">clear_line</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Cursor</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Clears all the output from the current line.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/install_poetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_line</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clears all the output from the current line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[2K&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="framdemo.install_poetry.Cursor.clear_line_after" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">clear_line_after</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Cursor</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Clears all the output from the current line after the current position.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/install_poetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_line_after</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clears all the output from the current line after the current position.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[K&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="framdemo.install_poetry.Cursor.clear_output" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">clear_output</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Cursor</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Clears all the output from the cursors' current position
to the end of the screen.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/install_poetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clears all the output from the cursors&#39; current position</span>
<span class="sd">    to the end of the screen.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0J&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="framdemo.install_poetry.Cursor.clear_screen" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">clear_screen</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Cursor</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Clears the entire screen.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/install_poetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cursor&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clears the entire screen.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[2J&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="framdemo.install_poetry.Installer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>Installer</code>


</h4>


    <div class="doc doc-contents ">









              <details class="quote">
                <summary>Source code in <code>framdemo/install_poetry.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Installer</span><span class="p">:</span>
    <span class="n">METADATA_URL</span> <span class="o">=</span> <span class="s2">&quot;https://pypi.org/pypi/poetry/json&quot;</span>
    <span class="n">VERSION_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;v?(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:\.(\d+))?&quot;</span>
        <span class="s2">&quot;(&quot;</span>
        <span class="s2">&quot;[._-]?&quot;</span>
        <span class="sa">r</span><span class="s2">&quot;(?:(stable|beta|b|rc|RC|alpha|a|patch|pl|p)((?:[.-]?\d+)*)?)?&quot;</span>
        <span class="s2">&quot;([.-]?dev)?&quot;</span>
        <span class="s2">&quot;)?&quot;</span>
        <span class="sa">r</span><span class="s2">&quot;(?:\+[^\s]+)?&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">preview</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">accept_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">git</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preview</span> <span class="o">=</span> <span class="n">preview</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force</span> <span class="o">=</span> <span class="n">force</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_accept_all</span> <span class="o">=</span> <span class="n">accept_all</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_git</span> <span class="o">=</span> <span class="n">git</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cursor</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bin_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bin_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bin_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bin_dir</span> <span class="o">=</span> <span class="n">bin_dir</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bin_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span> <span class="o">=</span> <span class="n">data_dir</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">version_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;VERSION&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allows_prereleases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preview</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_git</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_git</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">version</span><span class="p">,</span> <span class="n">current_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">display_pre_message</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_directories</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_is_self_upgrade_supported</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">mx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_REGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># the version is not semver, perhaps scm or file</span>
                <span class="c1"># we assume upgrade is supported</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="n">vx</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mx</span><span class="o">.</span><span class="n">groups</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]),</span> <span class="n">mx</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">vx</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">version</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_self_upgrade_supported</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span>
                <span class="n">colorize</span><span class="p">(</span>
                    <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;You are installing </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">. When using the current installer, &quot;</span>
                    <span class="s2">&quot;this version does not support updating using the &#39;self update&#39; &quot;</span>
                    <span class="s2">&quot;command. Please use 1.1.7 or later.&quot;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accept_all</span><span class="p">:</span>
                <span class="n">continue_install</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Do you want to continue? ([y]/n) &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;y&quot;</span>
                <span class="k">if</span> <span class="n">continue_install</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">}:</span>
                    <span class="k">return</span> <span class="mi">0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PoetryInstallationError</span><span class="p">(</span>
                <span class="n">return_code</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span>
                <span class="n">log</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_post_message</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Installs Poetry in $POETRY_HOME.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span>
            <span class="s2">&quot;Installing </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Poetry&quot;</span><span class="p">),</span>
                <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_env</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="k">as</span> <span class="n">env</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">install_poetry</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_bin</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_install_comment</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;Done&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">uninstall</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not currently installed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Poetry&quot;</span><span class="p">)),</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="mi">1</span>

        <span class="n">version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span>
                <span class="s2">&quot;Removing </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Poetry&quot;</span><span class="p">),</span>
                    <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="s2">&quot;Removing </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Poetry&quot;</span><span class="p">)))</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;poetry&quot;</span><span class="p">,</span> <span class="s2">&quot;poetry.bat&quot;</span><span class="p">,</span> <span class="s2">&quot;poetry.exe&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_install_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_overwrite</span><span class="p">(</span>
            <span class="s2">&quot;Installing </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Poetry&quot;</span><span class="p">),</span>
                <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span>
                <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VirtualEnvironment</span><span class="p">:</span>
        <span class="n">env_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;venv&quot;</span><span class="p">)</span>
        <span class="n">env_path_saved</span> <span class="o">=</span> <span class="n">env_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.save&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">env_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_install_comment</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;Saving existing environment&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">env_path_saved</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">env_path_saved</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">env_path</span><span class="p">,</span> <span class="n">env_path_saved</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_install_comment</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;Creating environment&quot;</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">VirtualEnvironment</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">env_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">env_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_install_comment</span><span class="p">(</span>
                    <span class="n">version</span><span class="p">,</span>
                    <span class="s2">&quot;An error occurred. Removing partial environment.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">env_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">env_path_saved</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_install_comment</span><span class="p">(</span>
                    <span class="n">version</span><span class="p">,</span>
                    <span class="s2">&quot;Restoring previously saved environment.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">env_path_saved</span><span class="p">,</span> <span class="n">env_path</span><span class="p">)</span>

            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">env_path_saved</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">env_path_saved</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_bin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">VirtualEnvironment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_install_comment</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;Creating script&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;poetry.exe&quot;</span> <span class="k">if</span> <span class="n">WINDOWS</span> <span class="k">else</span> <span class="s2">&quot;poetry&quot;</span>
        <span class="n">target_script</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">bin_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">symlink_to</span><span class="p">(</span><span class="n">target_script</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="c1"># This can happen if the user</span>
            <span class="c1"># does not have the correct permission on Windows</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">target_script</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">script</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">install_poetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">VirtualEnvironment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_install_comment</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;Installing Poetry&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_git</span><span class="p">:</span>
            <span class="n">specification</span> <span class="o">=</span> <span class="s2">&quot;git+&quot;</span> <span class="o">+</span> <span class="n">version</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">:</span>
            <span class="n">specification</span> <span class="o">=</span> <span class="n">version</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">specification</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;poetry==</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">env</span><span class="o">.</span><span class="n">pip</span><span class="p">(</span><span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="n">specification</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display_pre_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;poetry&quot;</span><span class="p">:</span> <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Poetry&quot;</span><span class="p">),</span>
            <span class="s2">&quot;DEMO_FOLDER&quot;</span><span class="p">:</span> <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="n">DEMO_FOLDER</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">PRE_MESSAGE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display_post_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">WINDOWS</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_post_message_windows</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">SHELL</span> <span class="o">==</span> <span class="s2">&quot;fish&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_post_message_fish</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_post_message_unix</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display_post_message_windows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_windows_path_var</span><span class="p">()</span>

        <span class="n">message</span> <span class="o">=</span> <span class="n">POST_MESSAGE_NOT_IN_PATH</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">)</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">POST_MESSAGE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span>
            <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">poetry</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Poetry&quot;</span><span class="p">),</span>
                <span class="n">version</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span>
                <span class="n">poetry_home_bin</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">),</span>
                <span class="n">poetry_executable</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;poetry&quot;</span><span class="p">)),</span>
                <span class="n">configure_message</span><span class="o">=</span><span class="n">POST_MESSAGE_CONFIGURE_WINDOWS</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">poetry_home_bin</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">test_command</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;poetry --version&quot;</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_windows_path_var</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">winreg</span>

        <span class="k">with</span> <span class="p">(</span>
            <span class="n">winreg</span><span class="o">.</span><span class="n">ConnectRegistry</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">winreg</span><span class="o">.</span><span class="n">HKEY_CURRENT_USER</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">root</span><span class="p">,</span>
            <span class="n">winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;Environment&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">winreg</span><span class="o">.</span><span class="n">KEY_ALL_ACCESS</span><span class="p">)</span> <span class="k">as</span> <span class="n">key</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">QueryValueEx</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;PATH&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">path</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display_post_message_fish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fish_user_paths</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;fish&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;echo $fish_user_paths&quot;</span><span class="p">],</span>
        <span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="n">POST_MESSAGE_NOT_IN_PATH</span>
        <span class="k">if</span> <span class="n">fish_user_paths</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">)</span> <span class="ow">in</span> <span class="n">fish_user_paths</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">POST_MESSAGE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span>
            <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">poetry</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Poetry&quot;</span><span class="p">),</span>
                <span class="n">version</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span>
                <span class="n">poetry_home_bin</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">),</span>
                <span class="n">poetry_executable</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;poetry&quot;</span><span class="p">)),</span>
                <span class="n">configure_message</span><span class="o">=</span><span class="n">POST_MESSAGE_CONFIGURE_FISH</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">poetry_home_bin</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">test_command</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;poetry --version&quot;</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display_post_message_unix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PATH&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="n">POST_MESSAGE_NOT_IN_PATH</span>
        <span class="k">if</span> <span class="n">paths</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">)</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">POST_MESSAGE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span>
            <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">poetry</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Poetry&quot;</span><span class="p">),</span>
                <span class="n">version</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span>
                <span class="n">poetry_home_bin</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">),</span>
                <span class="n">poetry_executable</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;poetry&quot;</span><span class="p">)),</span>
                <span class="n">configure_message</span><span class="o">=</span><span class="n">POST_MESSAGE_CONFIGURE_UNIX</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">poetry_home_bin</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">test_command</span><span class="o">=</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;poetry --version&quot;</span><span class="p">),</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ensure_directories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">current_version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">current_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Retrieving Poetry metadata&quot;</span><span class="p">))</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">METADATA_URL</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_compare_versions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">mx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_REGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">my</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_REGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

            <span class="n">vx</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mx</span><span class="o">.</span><span class="n">groups</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]),</span> <span class="n">mx</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">vy</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">my</span><span class="o">.</span><span class="n">groups</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]),</span> <span class="n">my</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">vx</span> <span class="o">&lt;</span> <span class="n">vy</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">vx</span> <span class="o">&gt;</span> <span class="n">vy</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>

            <span class="k">return</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">releases</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;releases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="n">key</span><span class="o">=</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">_compare_versions</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">releases</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Version </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_version</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">release</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">releases</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_REGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">release</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allows_prereleases</span><span class="p">():</span>
                    <span class="k">continue</span>

                <span class="n">version</span> <span class="o">=</span> <span class="n">release</span>

                <span class="k">break</span>

        <span class="k">if</span> <span class="n">current_version</span> <span class="o">==</span> <span class="n">version</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The latest version (</span><span class="si">{</span><span class="n">colorize</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">)</span><span class="si">}</span><span class="s2">) is already installed.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">current_version</span>

        <span class="k">return</span> <span class="n">version</span><span class="p">,</span> <span class="n">current_version</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_overwrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_decorated</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cursor</span><span class="o">.</span><span class="n">move_up</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cursor</span><span class="o">.</span><span class="n">clear_line</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Python Poetry&quot;</span><span class="p">})</span>

        <span class="k">with</span> <span class="n">closing</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">))</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="framdemo.install_poetry.Installer.install" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">install</span><span class="p">(</span><span class="n">version</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Installs Poetry in $POETRY_HOME.</p>


            <details class="quote">
              <summary>Source code in <code>framdemo/install_poetry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Installs Poetry in $POETRY_HOME.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span>
        <span class="s2">&quot;Installing </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;Poetry&quot;</span><span class="p">),</span>
            <span class="n">colorize</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_env</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="k">as</span> <span class="n">env</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install_poetry</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_bin</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_install_comment</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;Done&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>